# å‡½æ•°å¼æ¥å£é€‰æ‹©æŒ‡å—

## ğŸ¯ æ ¸å¿ƒå‡½æ•°å¼æ¥å£æ¦‚è§ˆ

### ğŸ“‹ æ¥å£å¯¹æ¯”è¡¨

| æ¥å£åç§° | æ–¹æ³•ç­¾å | ç”¨é€” | è¾“å…¥ | è¾“å‡º | å…¸å‹åœºæ™¯ |
|---------|---------|------|------|------|----------|
| `Supplier<T>` | `T get()` | ä¾›åº”å•† | æ—  | æœ‰ | æ•°æ®è·å–ã€æ‡’åŠ è½½ |
| `Consumer<T>` | `void accept(T t)` | æ¶ˆè´¹è€… | æœ‰ | æ—  | æ•°æ®å¤„ç†ã€å‰¯ä½œç”¨æ“ä½œ |
| `Function<T,R>` | `R apply(T t)` | å‡½æ•° | æœ‰ | æœ‰ | æ•°æ®è½¬æ¢ã€æ˜ å°„ |
| `Predicate<T>` | `boolean test(T t)` | æ–­è¨€ | æœ‰ | boolean | æ¡ä»¶åˆ¤æ–­ã€è¿‡æ»¤ |
| `Runnable` | `void run()` | æ‰§è¡Œå™¨ | æ—  | æ—  | ç®€å•ä»»åŠ¡æ‰§è¡Œ |

## ğŸ” è¯¦ç»†é€‰æ‹©æŒ‡å—

### 1. Supplier<T> - æ•°æ®ä¾›åº”å•†

**ä½•æ—¶ä½¿ç”¨ï¼š**
- éœ€è¦å»¶è¿Ÿè·å–æ•°æ®
- æ•°æ®è·å–å¯èƒ½å¤±è´¥éœ€è¦é‡è¯•
- ç¼“å­˜æœªå‘½ä¸­æ—¶çš„æ•°æ®åŠ è½½
- å·¥å‚æ–¹æ³•æ¨¡å¼

```java
// âœ… é€‚åˆä½¿ç”¨ Supplier çš„åœºæ™¯

// 1. ç¼“å­˜è·å–
public <T> T getFromCache(String key, Supplier<T> dataLoader) {
    T cached = cache.get(key);
    if (cached != null) {
        return cached;
    }
    
    // ç¼“å­˜æœªå‘½ä¸­ï¼Œä½¿ç”¨ Supplier è·å–æ•°æ®
    T data = dataLoader.get();
    cache.put(key, data);
    return data;
}

// ä½¿ç”¨
User user = getFromCache("user:123", () -> {
    // å¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢
    return userRepository.findByIdWithDetails(123L);
});

// 2. æ‡’åŠ è½½é…ç½®
public class ConfigManager {
    private final Supplier<Properties> configLoader;
    private Properties config;
    
    public ConfigManager(Supplier<Properties> configLoader) {
        this.configLoader = configLoader;
    }
    
    public String getProperty(String key) {
        if (config == null) {
            config = configLoader.get();  // å»¶è¿ŸåŠ è½½
        }
        return config.getProperty(key);
    }
}

// ä½¿ç”¨
ConfigManager manager = new ConfigManager(() -> {
    // åªæœ‰åœ¨çœŸæ­£éœ€è¦æ—¶æ‰åŠ è½½é…ç½®æ–‡ä»¶
    return loadConfigFromFile("application.properties");
});

// 3. é‡è¯•æœºåˆ¶
public <T> T executeWithRetry(Supplier<T> operation, int maxRetries) {
    for (int i = 0; i < maxRetries; i++) {
        try {
            return operation.get();  // æ¯æ¬¡é‡è¯•éƒ½è°ƒç”¨ Supplier
        } catch (Exception e) {
            if (i == maxRetries - 1) throw e;
            // ç­‰å¾…åé‡è¯•
            sleep(1000);
        }
    }
    throw new RuntimeException("é‡è¯•å¤±è´¥");
}

// ä½¿ç”¨
String result = executeWithRetry(() -> {
    return httpClient.get("https://api.example.com/data");
}, 3);
```

### 2. Consumer<T> - æ•°æ®æ¶ˆè´¹è€…

**ä½•æ—¶ä½¿ç”¨ï¼š**
- å¯¹æ•°æ®è¿›è¡Œå¤„ç†ä½†ä¸éœ€è¦è¿”å›å€¼
- æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œï¼ˆæ—¥å¿—ã€é€šçŸ¥ã€æ›´æ–°çŠ¶æ€ï¼‰
- æ„å»ºå™¨æ¨¡å¼ä¸­çš„é…ç½®å›è°ƒ
- äº‹ä»¶å¤„ç†

```java
// âœ… é€‚åˆä½¿ç”¨ Consumer çš„åœºæ™¯

// 1. æ•°æ®å¤„ç†ç®¡é“
public class DataProcessor {
    public void processUsers(List<User> users, Consumer<User> processor) {
        for (User user : users) {
            try {
                processor.accept(user);  // å¤„ç†æ¯ä¸ªç”¨æˆ·
            } catch (Exception e) {
                log.error("å¤„ç†ç”¨æˆ·å¤±è´¥: {}", user.getId(), e);
            }
        }
    }
}

// ä½¿ç”¨
processor.processUsers(userList, user -> {
    // å‘é€æ¬¢è¿é‚®ä»¶
    emailService.sendWelcomeEmail(user);
    // æ›´æ–°ç”¨æˆ·çŠ¶æ€
    user.setStatus(UserStatus.ACTIVE);
    userRepository.save(user);
});

// 2. æ„å»ºå™¨é…ç½®
public class EmailBuilder {
    public EmailBuilder withRecipients(Consumer<List<String>> recipientConfig) {
        List<String> recipients = new ArrayList<>();
        recipientConfig.accept(recipients);  // è®©ç”¨æˆ·é…ç½®æ”¶ä»¶äººåˆ—è¡¨
        this.recipients = recipients;
        return this;
    }
}

// ä½¿ç”¨
Email email = EmailBuilder.create()
    .withSubject("é€šçŸ¥")
    .withRecipients(recipients -> {
        recipients.add("admin@example.com");
        recipients.add("user@example.com");
        if (isUrgent) {
            recipients.add("manager@example.com");
        }
    })
    .build();

// 3. äº‹ä»¶ç›‘å¬
public class EventBus {
    private Map<Class<?>, List<Consumer<Object>>> listeners = new HashMap<>();
    
    public <T> void subscribe(Class<T> eventType, Consumer<T> listener) {
        listeners.computeIfAbsent(eventType, k -> new ArrayList<>())
                .add((Consumer<Object>) listener);
    }
    
    public void publish(Object event) {
        List<Consumer<Object>> eventListeners = listeners.get(event.getClass());
        if (eventListeners != null) {
            eventListeners.forEach(listener -> listener.accept(event));
        }
    }
}

// ä½¿ç”¨
eventBus.subscribe(UserRegisteredEvent.class, event -> {
    log.info("ç”¨æˆ·æ³¨å†Œ: {}", event.getUserId());
    // å‘é€æ¬¢è¿é‚®ä»¶
    emailService.sendWelcomeEmail(event.getUser());
});
```

### 3. Function<T,R> - æ•°æ®è½¬æ¢å™¨

**ä½•æ—¶ä½¿ç”¨ï¼š**
- æ•°æ®ç±»å‹è½¬æ¢
- ä¸šåŠ¡é€»è¾‘è®¡ç®—
- æ˜ å°„æ“ä½œ
- éœ€è¦è¾“å…¥å’Œè¾“å‡ºçš„åœºæ™¯

```java
// âœ… é€‚åˆä½¿ç”¨ Function çš„åœºæ™¯

// 1. æ•°æ®è½¬æ¢ç®¡é“
public class DataTransformer {
    public <T, R> List<R> transform(List<T> input, Function<T, R> transformer) {
        return input.stream()
                   .map(transformer)
                   .collect(Collectors.toList());
    }
    
    public <T, R> R transformSingle(T input, Function<T, R> transformer) {
        if (input == null) {
            return null;
        }
        return transformer.apply(input);
    }
}

// ä½¿ç”¨
List<UserDTO> userDTOs = transformer.transform(users, user -> {
    UserDTO dto = new UserDTO();
    dto.setId(user.getId());
    dto.setName(user.getName());
    dto.setEmail(user.getEmail());
    dto.setAge(calculateAge(user.getBirthDate()));
    return dto;
});

// 2. ç¼“å­˜è®¡ç®—ç»“æœ
public class ComputeCache {
    private final Map<String, Object> cache = new ConcurrentHashMap<>();
    
    @SuppressWarnings("unchecked")
    public <T, R> R computeIfAbsent(String key, T input, Function<T, R> computer) {
        return (R) cache.computeIfAbsent(key, k -> computer.apply(input));
    }
}

// ä½¿ç”¨
BigDecimal result = computeCache.computeIfAbsent(
    "tax:" + orderId,
    order,
    ord -> {
        // å¤æ‚çš„ç¨è´¹è®¡ç®—
        return calculateTax(ord.getAmount(), ord.getRegion());
    }
);

// 3. æ¡ä»¶è½¬æ¢
public class ConditionalTransformer {
    public <T, R> R transformIf(T input, 
                               Predicate<T> condition,
                               Function<T, R> transformer,
                               R defaultValue) {
        if (condition.test(input)) {
            return transformer.apply(input);
        }
        return defaultValue;
    }
}

// ä½¿ç”¨
String displayName = conditionalTransformer.transformIf(
    user,
    u -> u.getName() != null && !u.getName().trim().isEmpty(),
    u -> u.getName().toUpperCase(),
    "åŒ¿åç”¨æˆ·"
);
```

### 4. Predicate<T> - æ¡ä»¶åˆ¤æ–­å™¨

**ä½•æ—¶ä½¿ç”¨ï¼š**
- æ•°æ®è¿‡æ»¤
- æ¡ä»¶éªŒè¯
- ä¸šåŠ¡è§„åˆ™åˆ¤æ–­
- æƒé™æ£€æŸ¥

```java
// âœ… é€‚åˆä½¿ç”¨ Predicate çš„åœºæ™¯

// 1. æ•°æ®è¿‡æ»¤å™¨
public class DataFilter {
    public <T> List<T> filter(List<T> data, Predicate<T> condition) {
        return data.stream()
                  .filter(condition)
                  .collect(Collectors.toList());
    }
    
    public <T> boolean anyMatch(List<T> data, Predicate<T> condition) {
        return data.stream().anyMatch(condition);
    }
    
    public <T> boolean allMatch(List<T> data, Predicate<T> condition) {
        return data.stream().allMatch(condition);
    }
}

// ä½¿ç”¨
List<User> activeUsers = dataFilter.filter(users, user -> {
    return user.getStatus() == UserStatus.ACTIVE && 
           user.getLastLoginTime().isAfter(LocalDateTime.now().minusDays(30));
});

// 2. ä¸šåŠ¡è§„åˆ™éªŒè¯
public class BusinessRuleValidator {
    public <T> ValidationResult validate(T data, List<Predicate<T>> rules) {
        for (int i = 0; i < rules.size(); i++) {
            if (!rules.get(i).test(data)) {
                return ValidationResult.fail("è§„åˆ™ " + (i + 1) + " éªŒè¯å¤±è´¥");
            }
        }
        return ValidationResult.success();
    }
}

// ä½¿ç”¨
ValidationResult result = validator.validate(order, Arrays.asList(
    ord -> ord.getAmount().compareTo(BigDecimal.ZERO) > 0,  // é‡‘é¢å¤§äº0
    ord -> ord.getCustomerId() != null,                     // å®¢æˆ·IDä¸ä¸ºç©º
    ord -> ord.getItems().size() > 0,                       // è‡³å°‘æœ‰ä¸€ä¸ªå•†å“
    ord -> ord.getItems().stream().allMatch(item -> item.getQuantity() > 0)  // å•†å“æ•°é‡å¤§äº0
));

// 3. æƒé™æ£€æŸ¥
public class PermissionChecker {
    public <T> boolean hasPermission(T resource, User user, Predicate<T> permissionRule) {
        return permissionRule.test(resource);
    }
}

// ä½¿ç”¨
boolean canEdit = permissionChecker.hasPermission(document, currentUser, doc -> {
    return doc.getOwnerId().equals(currentUser.getId()) || 
           currentUser.hasRole("ADMIN") ||
           doc.getCollaborators().contains(currentUser.getId());
});
```

### 5. Runnable - ç®€å•ä»»åŠ¡æ‰§è¡Œå™¨

**ä½•æ—¶ä½¿ç”¨ï¼š**
- æ— å‚æ•°æ— è¿”å›å€¼çš„ç®€å•ä»»åŠ¡
- å¼‚æ­¥æ‰§è¡Œ
- å®šæ—¶ä»»åŠ¡
- æ¸…ç†æ“ä½œ

```java
// âœ… é€‚åˆä½¿ç”¨ Runnable çš„åœºæ™¯

// 1. å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ
public class AsyncExecutor {
    private final ExecutorService executor = Executors.newFixedThreadPool(10);
    
    public void executeAsync(Runnable task) {
        executor.submit(task);
    }
    
    public void executeWithDelay(Runnable task, long delaySeconds) {
        ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(1);
        scheduler.schedule(task, delaySeconds, TimeUnit.SECONDS);
    }
}

// ä½¿ç”¨
asyncExecutor.executeAsync(() -> {
    // å‘é€é‚®ä»¶é€šçŸ¥
    emailService.sendNotification("è®¢å•å·²åˆ›å»º", order);
});

asyncExecutor.executeWithDelay(() -> {
    // 5åˆ†é’Ÿåæ£€æŸ¥è®¢å•çŠ¶æ€
    checkOrderStatus(orderId);
}, 300);

// 2. èµ„æºæ¸…ç†
public class ResourceManager {
    public void withResource(Supplier<AutoCloseable> resourceSupplier, 
                           Consumer<AutoCloseable> resourceUser,
                           Runnable cleanup) {
        AutoCloseable resource = null;
        try {
            resource = resourceSupplier.get();
            resourceUser.accept(resource);
        } catch (Exception e) {
            log.error("èµ„æºä½¿ç”¨å¤±è´¥", e);
        } finally {
            if (resource != null) {
                try {
                    resource.close();
                } catch (Exception e) {
                    log.error("èµ„æºå…³é—­å¤±è´¥", e);
                }
            }
            // é¢å¤–çš„æ¸…ç†å·¥ä½œ
            cleanup.run();
        }
    }
}

// ä½¿ç”¨
resourceManager.withResource(
    () -> dataSource.getConnection(),
    conn -> {
        // ä½¿ç”¨æ•°æ®åº“è¿æ¥
        executeQuery(conn, sql);
    },
    () -> {
        // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        cleanupTempFiles();
        // æ¸…ç†ç¼“å­˜
        clearCache();
    }
);
```

## ğŸ¯ ç»„åˆä½¿ç”¨åœºæ™¯

### å¤šæ¥å£ç»„åˆ

```java
// å¤æ‚çš„æ•°æ®å¤„ç†ç®¡é“
public class DataPipeline<T> {
    public <R> DataPipeline<R> filter(Predicate<T> condition) {
        // è¿‡æ»¤æ•°æ®
        return new DataPipeline<>(data.stream().filter(condition).collect(Collectors.toList()));
    }
    
    public <R> DataPipeline<R> map(Function<T, R> mapper) {
        // è½¬æ¢æ•°æ®
        return new DataPipeline<>(data.stream().map(mapper).collect(Collectors.toList()));
    }
    
    public void forEach(Consumer<T> action) {
        // å¤„ç†æ¯ä¸ªå…ƒç´ 
        data.forEach(action);
    }
    
    public T findFirst(Predicate<T> condition, Supplier<T> defaultSupplier) {
        // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
        return data.stream()
                  .filter(condition)
                  .findFirst()
                  .orElseGet(defaultSupplier);
    }
}

// ä½¿ç”¨
new DataPipeline<>(users)
    .filter(user -> user.getAge() >= 18)           // Predicate
    .map(user -> user.getEmail())                  // Function
    .forEach(email -> sendEmail(email));           // Consumer

User defaultUser = new DataPipeline<>(users)
    .findFirst(
        user -> user.getRole() == Role.ADMIN,      // Predicate
        () -> createDefaultAdmin()                 // Supplier
    );
```

## ğŸ“‹ é€‰æ‹©å†³ç­–æ ‘

```
éœ€è¦å›è°ƒå‡½æ•°ï¼Ÿ
â”œâ”€ æ— è¾“å…¥å‚æ•°ï¼Ÿ
â”‚  â”œâ”€ æœ‰è¿”å›å€¼ï¼Ÿ â†’ Supplier<T>
â”‚  â””â”€ æ— è¿”å›å€¼ï¼Ÿ â†’ Runnable
â””â”€ æœ‰è¾“å…¥å‚æ•°ï¼Ÿ
   â”œâ”€ æ— è¿”å›å€¼ï¼Ÿ â†’ Consumer<T>
   â”œâ”€ è¿”å›booleanï¼Ÿ â†’ Predicate<T>
   â””â”€ è¿”å›å…¶ä»–ç±»å‹ï¼Ÿ â†’ Function<T,R>
```

## ğŸª å®é™…é¡¹ç›®ä¸­çš„é€‰æ‹©å»ºè®®

### 1. **æ„å»ºå™¨æ¨¡å¼**
```java
// é…ç½®ç±»å±æ€§ â†’ Consumer
builder.configureDatabase(db -> {
    db.setUrl("jdbc:postgresql://localhost:5432/mydb");
    db.setUsername("user");
});

// æ¡ä»¶é…ç½® â†’ Predicate + Consumer
builder.configureIf(
    env -> "production".equals(env.getProfile()),  // Predicate
    config -> config.enableSsl(true)              // Consumer
);
```

### 2. **ç¼“å­˜æ¨¡å¼**
```java
// æ•°æ®è·å– â†’ Supplier
cacheManager.getOrCompute(key, () -> expensiveOperation());

// æ•°æ®è½¬æ¢ â†’ Function
cacheManager.getOrTransform(key, data -> transformData(data));
```

### 3. **éªŒè¯æ¨¡å¼**
```java
// æ¡ä»¶éªŒè¯ â†’ Predicate
validator.validate(data, d -> d.getAge() >= 18);

// å¤æ‚éªŒè¯ â†’ Function
validator.validateAndTransform(data, d -> {
    if (d.isValid()) {
        return ValidationResult.success(d);
    }
    return ValidationResult.error("éªŒè¯å¤±è´¥");
});
```

### 4. **äº‹ä»¶å¤„ç†**
```java
// äº‹ä»¶ç›‘å¬ â†’ Consumer
eventBus.on(UserCreatedEvent.class, event -> handleUserCreated(event));

// æ¡ä»¶äº‹ä»¶å¤„ç† â†’ Predicate + Consumer
eventBus.onIf(
    event -> event.getUser().isVip(),     // Predicate
    event -> sendVipWelcomeEmail(event)   // Consumer
);
```

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **æ˜ç¡®è¯­ä¹‰**ï¼šé€‰æ‹©æœ€èƒ½è¡¨è¾¾æ„å›¾çš„æ¥å£
2. **ä¿æŒç®€å•**ï¼šé¿å…åœ¨Lambdaä¸­å†™è¿‡äºå¤æ‚çš„é€»è¾‘
3. **å¼‚å¸¸å¤„ç†**ï¼šåœ¨æ¡†æ¶å±‚ç»Ÿä¸€å¤„ç†å¼‚å¸¸
4. **ç±»å‹å®‰å…¨**ï¼šå……åˆ†åˆ©ç”¨æ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨

### âŒ é¿å…çš„åšæ³•

1. **æ»¥ç”¨Function**ï¼šä¸è¦æŠŠæ‰€æœ‰å›è°ƒéƒ½ç”¨Function
2. **å¿½ç•¥è¯­ä¹‰**ï¼šä¸è¦ä»…ä»…å› ä¸ºç­¾ååŒ¹é…å°±é€‰æ‹©æ¥å£
3. **è¿‡åº¦åµŒå¥—**ï¼šé¿å…Lambdaä¸­å†åµŒå¥—Lambda
4. **å‰¯ä½œç”¨æ··ä¹±**ï¼šFunctionåº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œé¿å…å‰¯ä½œç”¨

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

| åœºæ™¯ | æ¨èæ¥å£ | ç¤ºä¾‹ |
|------|----------|------|
| æ‡’åŠ è½½æ•°æ® | `Supplier<T>` | `() -> loadFromDatabase()` |
| å¤„ç†æ•°æ® | `Consumer<T>` | `user -> sendEmail(user)` |
| è½¬æ¢æ•°æ® | `Function<T,R>` | `user -> user.getName()` |
| è¿‡æ»¤æ¡ä»¶ | `Predicate<T>` | `user -> user.isActive()` |
| ç®€å•ä»»åŠ¡ | `Runnable` | `() -> cleanup()` |
| æ„å»ºå™¨é…ç½® | `Consumer<T>` | `builder -> builder.setName("test")` |
| ç¼“å­˜è·å– | `Supplier<T>` | `() -> computeExpensiveValue()` |
| æ¡ä»¶æ‰§è¡Œ | `Predicate<T>` | `order -> order.getAmount() > 100` |

è®°ä½ï¼š**é€‰æ‹©æœ€èƒ½è¡¨è¾¾ä½ æ„å›¾çš„æ¥å£ï¼Œè®©ä»£ç è‡ªæ–‡æ¡£åŒ–ï¼**